#!/bin/bash
#==========================================#
#                 poshd                    #
#  https://github.com/ponyofshadows/poshd  #
#==========================================#
set -e
PO_PATH="$HOME/tmp/test/all"

source lib/functions.sh

# ----------------
## Strategies for parsing parameters
# 
# - Adjacent non-option parameters will be concatenated into one object
# |__ objects starting with "-e" or without preceding options -> (event, title,do_rm, date, path)
# |__ objects starting with "-p" -> (project, title,do_rm, status, path)
# |__ objects starting with "-f" -> (file, path)
# |__ objects starting with "-d" -> (disk, name, do_rm. status)
# |__ objects starting with "-l" -> (keyword, content, date_from, date_to)
# - objects call specfic functions
# |__ event -> update_event
# |__ project -> update_project
# |__ disk -> update_disk
# |__ event & project -> link
#
# - some options call specfic functions
# |__ "-init" --> po_init
# |__ "-l" --> list
# |__ "-b" --> backup
# |__ "-r" --> recover
# |__ "-rm" --> rm_event
# ----------------
CURRENT_CONTENT=""
current_object=("event")
object_list=()
declare -A option_actions

if [ "$#" == 0 ]; then
  # equivalent to option "po -l"
  echo "list"
else
  for arg in "$@"
  do
    if [[ ! $arg == -* ]]; then
      # 2. If current arg is not a option
      echo "content"
    else  
      # 1. If current arg is a option
      # |__ 1) complete last object
      if [ -n $CURRENT_CONTENT ]; then
        current_object[1]=$CURRENT_CONTENT
        CURRENT_CONTENT=""
        object_list+=("${current_object}")
      fi
      current_object=("event")
      # |__ 2) Specific operations
      if [[ $arg == -e* ]]; then
        #current_object[0]="event"
        echo "test"
      elif [[ $arg == -p* ]]; then
        current_object[0]="project"
      elif [[ $arg == -f* ]]; then
        current_object[0]="file"
      elif [[ $arg == -d* ]]; then
        current_object[0]="disk"
      elif [[ $arg == -l* ]]; then
        current_object[0]="keywords"
      elif [[ $arg == -rm* ]]; then
        option_actions["remove"]=1
      elif [[ $arg == -b* ]]; then
        option_actions["backup"]=1
      elif [[ $arg == -r* ]]; then
        option_actions["recover"]=1
      elif [[ $arg == -init* ]]; then
        po_init
      fi
    fi
  done
fi
